(this.webpackJsonpwidget=this.webpackJsonpwidget||[]).push([[0],{248:function(e,t,a){},500:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(66),i=a.n(n),o=(a(248),a(24)),c=a(25),l=a(36),d=a(27),h=a(26),p=a(242),u=a(241),j=a.n(u),b=a(2),g=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){if(!this.props.value)return null;if(this.props.value===Object(this.props.value)&&!Array.isArray(this.props.value))return null;var e=this.props.value,t=this.props,a=t.field,s=t.attribs,r=t.nodeData;Array.isArray(e)&&(e=e.join(", "));var n="";if(1==s.showLabel){var i=s.label;n=Object(b.jsx)("div",{className:"node-field-label "+a,children:i})}else n="";return s.truncate&&e.length>s.truncate&&(e=e.slice(0,s.truncate)+"..."),s.link&&(e=Object(b.jsx)("a",{href:r[s.link],children:e})),Object(b.jsxs)("div",{className:"node-field "+a,children:[n,Object(b.jsx)("div",{className:"node-field-value "+a,children:e})]})}}]),a}(r.a.Component),m=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){var e=[];if("HTML"==this.props.settings.apiNodeFormat)e=Object(b.jsx)("div",{dangerouslySetInnerHTML:{__html:this.props.nodeData}});else if(this.props.settings.directoryDisplaySchema)for(var t in this.props.settings.directoryDisplaySchema)this.props.settings.directoryDisplaySchema.hasOwnProperty(t)&&e.push(Object(b.jsx)(g,{field:t,value:this.props.nodeData[t],attribs:this.props.settings.directoryDisplaySchema[t],nodeData:this.props.nodeData}));return Object(b.jsx)("div",{className:"directory-node",children:e})}}]),a}(r.a.Component),f=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).nodesPerPage=s.props.settings.nodesPerPage||15,s.handlePageClick=function(e){s.setState({activePage:e.selected,pageNodes:s.getPageNodes(e.selected)})},s.getPageNodes=function(e){var t=e*s.nodesPerPage,a=t+s.nodesPerPage;return s.props.nodes.slice(t,a)},s.state={activePage:0,pageNodes:s.getPageNodes(0)},s}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.nodes,a=this.state.pageNodes;return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"nodeList",children:[Object(b.jsxs)("div",{className:"node-count",children:[t.length," results found"]}),a.map((function(t){return Object(b.jsx)(m,{nodeData:t,settings:e.props.settings})}))]}),Object(b.jsx)("div",{className:"react-paginate",children:Object(b.jsx)(j.a,{previousLabel:"prev",nextLabel:"next",breakLabel:"...",breakClassName:"break-me",pageCount:t.length/this.nodesPerPage,marginPagesDisplayed:2,pageRangeDisplayed:this.nodesPerPage,onPageChange:this.handlePageClick,containerClassName:"pagination",subContainerClassName:"pages pagination",pageClassName:"page-link-li",activeClassName:"active"})})]})}}]),a}(r.a.Component),v=a(502),O=a(505),x=a(503),y=a(504),S=a(15),N=a.n(S),k=function(e){var t=e.node;return Object(b.jsxs)("div",{children:[t.image&&Object(b.jsx)("img",{src:t.image[0].url,alt:"Node logo",maxWidth:"50%",height:8}),Object(b.jsx)("div",{children:t.url||t.urls?Object(b.jsx)("a",{href:t.url||t.urls[0].url,target:"_blank",rel:"noopener noreferrer",children:Object(b.jsx)("span",{wordBreak:"break-all",children:t.name})}):Object(b.jsx)("span",{wordBreak:"break-all",children:t.name})}),t.description&&Object(b.jsx)("div",{children:t.description.length>250?"".concat(t.description.slice(0,250),"..."):t.description})]})};a(499);delete N.a.Icon.Default.prototype._getIconUrl;var C=function(e){var t=e.nodes,a=e.settings;return N.a.Icon.Default.mergeOptions({iconRetinaUrl:a.clientPathToApp+"public/images/marker-icon-2x.png",iconUrl:a.clientPathToApp+"public/images/marker-icon.png",shadowUrl:a.clientPathToApp+"public/images/marker-shadow.png"}),Object(b.jsxs)(v.a,{center:a.mapCenter,zoom:a.mapZoom,scrollWheelZoom:a.mapAllowScrollZoom,style:{height:"70vh",width:"100%",margin:"auto"},children:[Object(b.jsx)(O.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map((function(e){if(e.data){var t=e.id;(e=e.data).id=t}return Object(b.jsx)("div",{children:e.geolocation?Object(b.jsx)(x.a,{position:[parseFloat(e.geolocation.lat),parseFloat(e.geolocation.lon)],children:Object(b.jsx)(y.a,{children:Object(b.jsx)(k,{node:e})})}):null},"".concat(e.id||e.objectID))}))]})},P=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).fetchNodes=s.fetchNodes.bind(Object(l.a)(s)),s.handleFilterSubmit=s.handleFilterSubmit.bind(Object(l.a)(s)),s.handleSearchSubmit=s.handleSearchSubmit.bind(Object(l.a)(s)),s.handleSearchChange=s.handleSearchChange.bind(Object(l.a)(s)),s.state={nodes:[],filterFormData:e.settings.formData},s}return Object(c.a)(a,[{key:"fetchNodes",value:function(e){var t=this,a=this.props.settings.apiUrl,s=this.props.settings.apiNodeFormat;this.setState({isLoaded:!1});var r=new URLSearchParams(e);"directory"==this.props.interfaceComp&&r.set("format",s),this.state.search&&r.set("search",this.state.search),fetch(a+"?"+r.toString()).then((function(e){return e.json()})).then((function(e){t.setState({isLoaded:!0,nodes:e})}),(function(e){t.setState({isLoaded:!0,error:e})}))}},{key:"handleSearchChange",value:function(e){this.setState({search:e.target.value})}},{key:"handleSearchSubmit",value:function(e){e.preventDefault(),this.fetchNodes()}},{key:"handleFilterSubmit",value:function(e,t){var a=this,s=e.formData,r="";this.setState({filterFormData:s}),Object.keys(s).forEach((function(e,t){if(s[e]&&"any"!=s[e]&&""!=s[e]){if("operator"in a.props.settings.filterSchema.properties[e])var n=a.props.settings.filterSchema.properties[e].operator;else n="equals";r+="filters["+t+"][0]="+e+"&",r+="filters["+t+"][1]="+n+"&",r+="filters["+t+"][2]="+s[e]+"&"}})),this.fetchNodes(r)}},{key:"componentDidMount",value:function(){this.fetchNodes()}},{key:"render",value:function(){var e,t=this.props.settings.filterSchema,a=this.state,s=a.error,r=a.isLoaded,n=a.nodes;return s?e=Object(b.jsxs)("div",{children:["Error: ",s.message]}):r?"directory"==this.props.interfaceComp?e=Object(b.jsx)(f,{nodes:n,settings:this.props.settings}):"map"==this.props.interfaceComp&&(e=Object(b.jsx)(C,{nodes:n,settings:this.props.settings})):e=Object(b.jsx)("div",{children:"Loading..."}),Object(b.jsxs)("div",{children:[Object(b.jsx)("div",{className:"mri-filter-form",children:Object(b.jsx)(p.a,{schema:t,formData:this.state.filterFormData,onChange:this.handleFilterSubmit,onError:console.log("errors",this)})}),Object(b.jsx)("div",{className:"mri-search-form",children:Object(b.jsxs)("form",{action:"/",onSubmit:this.handleSearchSubmit,children:[Object(b.jsx)("input",{type:"text",name:"search",onChange:this.handleSearchChange,value:this.state.search}),Object(b.jsx)("button",{type:"submit",children:"Search"})]})}),e]})}}]),a}(r.a.Component),D=document.getElementById("murmurations-react-directory"),w=document.getElementById("murmurations-react-map");if(D){var L=window.wpReactSettings;i.a.render(Object(b.jsx)(P,{settings:L,interfaceComp:"directory"}),D)}if(w){var F=window.wpReactSettings;i.a.render(Object(b.jsx)(P,{settings:F,interfaceComp:"map"}),w)}}},[[500,1,2]]]);
//# sourceMappingURL=main.ef194182.chunk.js.map