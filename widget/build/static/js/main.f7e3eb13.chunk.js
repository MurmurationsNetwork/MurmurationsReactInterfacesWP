(this.webpackJsonpwidget=this.webpackJsonpwidget||[]).push([[0],{248:function(e,t,a){},500:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),i=a(65),n=a.n(i),o=(a(248),a(24)),c=a(25),l=a(66),d=a(27),p=a(26),h=a(242),u=a(241),j=a.n(u),g=a(2),b=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){if(!this.props.value)return null;if(this.props.value===Object(this.props.value)&&!Array.isArray(this.props.value))return null;var e=this.props.value,t=this.props,a=t.field,s=t.attribs,r=t.nodeData;Array.isArray(e)&&(e=e.join(", "));var i="";if(1==s.showLabel){var n=s.label;i=Object(g.jsx)("div",{className:"node-field-label "+a,children:n})}else i="";return s.truncate&&e.length>s.truncate&&(e=e.slice(0,s.truncate)+"..."),s.link&&(e=Object(g.jsx)("a",{href:r[s.link],children:e})),Object(g.jsxs)("div",{className:"node-field "+a,children:[i,Object(g.jsx)("div",{className:"node-field-value "+a,children:e})]})}}]),a}(r.a.Component),m=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){var e=[];if(this.props.settings.directoryDisplaySchema)for(var t in this.props.settings.directoryDisplaySchema)this.props.settings.directoryDisplaySchema.hasOwnProperty(t)&&e.push(Object(g.jsx)(b,{field:t,value:this.props.nodeData[t],attribs:this.props.settings.directoryDisplaySchema[t],nodeData:this.props.nodeData}));return Object(g.jsx)("div",{className:"directory-node",children:e})}}]),a}(r.a.Component),f=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).nodesPerPage=s.props.settings.nodesPerPage||15,s.handlePageClick=function(e){s.setState({activePage:e.selected,pageNodes:s.getPageNodes(e.selected)})},s.getPageNodes=function(e){var t=e*s.nodesPerPage,a=t+s.nodesPerPage;return s.props.nodes.slice(t,a)},s.state={activePage:0,pageNodes:s.getPageNodes(0)},s}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.nodes,a=this.state.pageNodes;return Object(g.jsxs)("div",{children:[Object(g.jsxs)("div",{className:"nodeList",children:[Object(g.jsxs)("div",{className:"node-count",children:[t.length," results found"]}),a.map((function(t){return Object(g.jsx)(m,{nodeData:t,settings:e.props.settings})}))]}),Object(g.jsx)("div",{className:"react-paginate",children:Object(g.jsx)(j.a,{previousLabel:"prev",nextLabel:"next",breakLabel:"...",breakClassName:"break-me",pageCount:t.length/this.nodesPerPage,marginPagesDisplayed:2,pageRangeDisplayed:this.nodesPerPage,onPageChange:this.handlePageClick,containerClassName:"pagination",subContainerClassName:"pages pagination",pageClassName:"page-link-li",activeClassName:"active"})})]})}}]),a}(r.a.Component),v=a(502),O=a(505),x=a(503),y=a(504),k=a(15),N=a.n(k),P=function(e){var t=e.node;return Object(g.jsxs)("div",{children:[t.image&&Object(g.jsx)("img",{src:t.image[0].url,alt:"Node logo",maxWidth:"50%",height:8}),Object(g.jsx)("div",{children:t.url||t.urls?Object(g.jsx)("a",{href:t.url||t.urls[0].url,target:"_blank",rel:"noopener noreferrer",children:Object(g.jsx)("span",{wordBreak:"break-all",children:t.name})}):Object(g.jsx)("span",{wordBreak:"break-all",children:t.name})}),t.description&&Object(g.jsx)("div",{children:t.description.length>250?"".concat(t.description.slice(0,250),"..."):t.description})]})};a(499);delete N.a.Icon.Default.prototype._getIconUrl;var D=function(e){var t=e.nodes,a=e.settings;return N.a.Icon.Default.mergeOptions({iconRetinaUrl:a.clientPathToApp+"public/images/marker-icon-2x.png",iconUrl:a.clientPathToApp+"public/images/marker-icon.png",shadowUrl:a.clientPathToApp+"public/images/marker-shadow.png"}),Object(g.jsxs)(v.a,{center:a.mapCenter,zoom:a.mapZoom,scrollWheelZoom:a.mapAllowScrollZoom,style:{height:"70vh",width:"100%",margin:"auto"},children:[Object(g.jsx)(O.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.map((function(e){if(e.data){var t=e.id;(e=e.data).id=t}return Object(g.jsx)("div",{children:e.geolocation?Object(g.jsx)(x.a,{position:[parseFloat(e.geolocation.lat),parseFloat(e.geolocation.lon)],children:Object(g.jsx)(y.a,{children:Object(g.jsx)(P,{node:e})})}):null},"".concat(e.id||e.objectID))}))]})},C=function(e){Object(d.a)(a,e);var t=Object(p.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).fetchNodes=s.fetchNodes.bind(Object(l.a)(s)),s.handleFilterSubmit=s.handleFilterSubmit.bind(Object(l.a)(s)),s.state={nodes:[],filterFormData:e.settings.formData},s}return Object(c.a)(a,[{key:"fetchNodes",value:function(e){var t=this,a=this.props.settings.apiUrl;this.setState({isLoaded:!1}),fetch(a+"?"+e).then((function(e){return e.json()})).then((function(e){t.setState({isLoaded:!0,nodes:e})}),(function(e){t.setState({isLoaded:!0,error:e})}))}},{key:"handleFilterSubmit",value:function(e,t){var a=this,s=e.formData,r="";this.setState({filterFormData:s}),Object.keys(s).forEach((function(e,t){if(s[e]&&"any"!=s[e]&&""!=s[e]){if("operator"in a.props.settings.filterSchema.properties[e])var i=a.props.settings.filterSchema.properties[e].operator;else i="equals";r+="filters["+t+"][0]="+e+"&",r+="filters["+t+"][1]="+i+"&",r+="filters["+t+"][2]="+s[e]+"&"}})),this.fetchNodes(r)}},{key:"componentDidMount",value:function(){this.fetchNodes()}},{key:"render",value:function(){var e,t=this.props.settings.filterSchema,a=this.state,s=a.error,r=a.isLoaded,i=a.nodes;return s?e=Object(g.jsxs)("div",{children:["Error: ",s.message]}):r?"directory"==this.props.interfaceComp?e=Object(g.jsx)(f,{nodes:i,settings:this.props.settings}):"map"==this.props.interfaceComp&&(e=Object(g.jsx)(D,{nodes:i,settings:this.props.settings})):e=Object(g.jsx)("div",{children:"Loading..."}),Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{className:"mri-filter-form",children:Object(g.jsx)(h.a,{schema:t,formData:this.state.filterFormData,onChange:this.handleFilterSubmit,onError:console.log("errors",this)})}),e]})}}]),a}(r.a.Component),S=document.getElementById("murmurations-react-directory"),w=document.getElementById("murmurations-react-map");if(S){var L=window.wpReactSettings;n.a.render(Object(g.jsx)(C,{settings:L,interfaceComp:"directory"}),S)}if(w){var F=window.wpReactSettings;n.a.render(Object(g.jsx)(C,{settings:F,interfaceComp:"map"}),w)}}},[[500,1,2]]]);
//# sourceMappingURL=main.f7e3eb13.chunk.js.map