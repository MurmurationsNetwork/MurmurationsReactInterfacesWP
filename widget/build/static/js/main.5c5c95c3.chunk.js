(this.webpackJsonpwidget=this.webpackJsonpwidget||[]).push([[0],{248:function(e,t,a){},500:function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),i=a(66),n=a.n(i),o=(a(248),a(24)),c=a(25),l=a(36),d=a(27),h=a(26),p=a(242),u=a(241),j=a.n(u),m=a(2),b=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){if(!this.props.value)return null;if(this.props.value===Object(this.props.value)&&!Array.isArray(this.props.value))return null;var e=this.props.value,t=this.props,a=t.field,s=t.attribs,r=t.nodeData;Array.isArray(e)&&(e=e.join(", "));var i="";if(1==s.showLabel){var n=s.label;i=Object(m.jsx)("div",{className:"node-field-label "+a,children:n})}else i="";return s.truncate&&e.length>s.truncate&&(e=e.slice(0,s.truncate)+"..."),s.link&&(e=Object(m.jsx)("a",{href:r[s.link],children:e})),Object(m.jsxs)("div",{className:"node-field "+a,children:[i,Object(m.jsx)("div",{className:"node-field-value "+a,children:e})]})}}]),a}(r.a.Component),g=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(c.a)(a,[{key:"render",value:function(){var e=[];if("HTML"==this.props.settings.apiNodeFormat)e=Object(m.jsx)("div",{dangerouslySetInnerHTML:{__html:this.props.nodeData}});else if(this.props.settings.directoryDisplaySchema)for(var t in this.props.settings.directoryDisplaySchema)this.props.settings.directoryDisplaySchema.hasOwnProperty(t)&&e.push(Object(m.jsx)(b,{field:t,value:this.props.nodeData[t],attribs:this.props.settings.directoryDisplaySchema[t],nodeData:this.props.nodeData}));return Object(m.jsx)("div",{className:"directory-node",children:e})}}]),a}(r.a.Component),f=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).nodesPerPage=s.props.settings.nodesPerPage||15,s.handlePageClick=function(e){s.setState({activePage:e.selected,pageNodes:s.getPageNodes()})},s.getPageNodes=function(){var e=parseInt(s.state.activePage)*s.nodesPerPage,t=parseInt(e)+parseInt(s.nodesPerPage);return s.props.nodes.slice(e,t)},s.state={activePage:0},s}return Object(c.a)(a,[{key:"render",value:function(){var e,t=this,a=this.props.nodes,s=this.getPageNodes();return this.props.loaded||(e=Object(m.jsx)("div",{class:"mri-directory-loading",children:Object(m.jsx)("img",{src:this.props.settings.clientPathToApp+"public/images/spinner.gif"})})),Object(m.jsxs)("div",{children:[this.props.loaded?Object(m.jsxs)("div",{className:"nodeList",children:[Object(m.jsxs)("div",{className:"node-count",children:[a.length," results found"]}),s.map((function(e){return Object(m.jsx)(g,{nodeData:e,settings:t.props.settings})}))]}):e,Object(m.jsx)("div",{className:"react-paginate",children:Object(m.jsx)(j.a,{previousLabel:"prev",nextLabel:"next",breakLabel:"...",breakClassName:"break-me",pageCount:a.length/this.nodesPerPage,marginPagesDisplayed:2,pageRangeDisplayed:this.nodesPerPage,onPageChange:this.handlePageClick,containerClassName:"pagination",subContainerClassName:"pages pagination",pageClassName:"page-link-li",activeClassName:"active"})})]})}}]),a}(r.a.Component),v=a(502),O=a(505),x=a(503),y=a(504),S=a(15),P=a.n(S),k=function(e){var t=e.node;return Object(m.jsxs)("div",{children:[t.image&&Object(m.jsx)("img",{src:t.image[0].url,alt:"Node logo",maxWidth:"50%",height:8}),Object(m.jsx)("div",{children:t.url||t.urls?Object(m.jsx)("a",{href:t.url||t.urls[0].url,target:"_blank",rel:"noopener noreferrer",children:Object(m.jsx)("span",{wordBreak:"break-all",children:t.name})}):Object(m.jsx)("span",{wordBreak:"break-all",children:t.name})}),t.description&&Object(m.jsx)("div",{children:t.description.length>250?"".concat(t.description.slice(0,250),"..."):t.description})]})};a(499);delete P.a.Icon.Default.prototype._getIconUrl;var N=function(e){var t,a=e.nodes,s=e.settings,r=e.loaded;return P.a.Icon.Default.mergeOptions({iconRetinaUrl:s.clientPathToApp+"public/images/marker-icon-2x.png",iconUrl:s.clientPathToApp+"public/images/marker-icon.png",shadowUrl:s.clientPathToApp+"public/images/marker-shadow.png"}),r||(t=Object(m.jsx)("div",{class:"mri-map-loading",children:Object(m.jsx)("img",{src:s.clientPathToApp+"public/images/spinner.gif"})})),Object(m.jsxs)("div",{class:"mri-map-outer-container",children:[t,Object(m.jsxs)(v.a,{center:s.mapCenter,zoom:s.mapZoom,scrollWheelZoom:s.mapAllowScrollZoom,style:{height:"70vh",width:"100%",margin:"auto"},children:[Object(m.jsx)(O.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a.map((function(e){if(e.data){var t=e.id;(e=e.data).id=t}return Object(m.jsx)("div",{children:e.geolocation?Object(m.jsx)(x.a,{position:[parseFloat(e.geolocation.lat),parseFloat(e.geolocation.lon)],children:Object(m.jsx)(y.a,{children:Object(m.jsx)(k,{node:e})})}):null},"".concat(e.id||e.objectID))}))]})]})},C=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).fetchNodes=s.fetchNodes.bind(Object(l.a)(s)),s.handleFilterSubmit=s.handleFilterSubmit.bind(Object(l.a)(s)),s.handleSearchSubmit=s.handleSearchSubmit.bind(Object(l.a)(s)),s.handleSearchChange=s.handleSearchChange.bind(Object(l.a)(s)),s.state={nodes:[],filterFormData:e.settings.formData},s}return Object(c.a)(a,[{key:"fetchNodes",value:function(e){var t=this,a=this.props.settings.apiUrl,s=this.props.settings.apiNodeFormat;this.setState({isLoaded:!1,nodes:[]});var r=new URLSearchParams(e);"directory"==this.props.interfaceComp&&r.set("format",s),this.state.search&&r.set("search",this.state.search),fetch(a+"?"+r.toString()).then((function(e){return e.json()})).then((function(e){t.setState({isLoaded:!0,nodes:e})}),(function(e){t.setState({isLoaded:!0,error:e})}))}},{key:"handleSearchChange",value:function(e){this.setState({search:e.target.value})}},{key:"handleSearchSubmit",value:function(e){e.preventDefault(),this.fetchNodes()}},{key:"handleFilterSubmit",value:function(e,t){var a=this,s=e.formData,r="";this.setState({filterFormData:s}),Object.keys(s).forEach((function(e,t){if(s[e]&&"any"!=s[e]&&""!=s[e]){if("operator"in a.props.settings.filterSchema.properties[e])var i=a.props.settings.filterSchema.properties[e].operator;else i="equals";r+="filters["+t+"][0]="+e+"&",r+="filters["+t+"][1]="+i+"&",r+="filters["+t+"][2]="+s[e]+"&"}})),this.fetchNodes(r)}},{key:"componentDidMount",value:function(){this.fetchNodes()}},{key:"render",value:function(){var e,t=this.props.settings.filterSchema,a=this.state,s=a.error,r=a.isLoaded,i=a.nodes;return s?e=Object(m.jsxs)("div",{children:["Error: ",s.message]}):"directory"==this.props.interfaceComp?e=Object(m.jsx)(f,{nodes:i,settings:this.props.settings,loaded:r}):"map"==this.props.interfaceComp&&(e=Object(m.jsx)(N,{nodes:i,settings:this.props.settings,loaded:r})),Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"mri-filter-form",children:Object(m.jsx)(p.a,{schema:t,formData:this.state.filterFormData,onChange:this.handleFilterSubmit,onError:console.log("errors",this)})}),Object(m.jsx)("div",{className:"mri-search-form",children:Object(m.jsxs)("form",{action:"/",onSubmit:this.handleSearchSubmit,children:[Object(m.jsx)("input",{type:"text",name:"search",onChange:this.handleSearchChange,value:this.state.search}),Object(m.jsx)("button",{type:"submit",children:"Search"})]})}),e]})}}]),a}(r.a.Component),D=document.getElementById("murmurations-react-directory"),w=document.getElementById("murmurations-react-map");if(D){var L=window.wpReactSettings;n.a.render(Object(m.jsx)(C,{settings:L,interfaceComp:"directory"}),D)}if(w){var F=window.wpReactSettings;n.a.render(Object(m.jsx)(C,{settings:F,interfaceComp:"map"}),w)}}},[[500,1,2]]]);
//# sourceMappingURL=main.5c5c95c3.chunk.js.map