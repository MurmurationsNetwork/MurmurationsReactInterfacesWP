(this.webpackJsonpwidget=this.webpackJsonpwidget||[]).push([[0],{248:function(e,t,a){},500:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(63),i=a.n(r),o=(a(248),a(221)),c=a(222),l=a(26),d=a(242),h=a(241),p=a(240),u=a(25),j=a(239),m=a.n(j),g=a(2);var b=function(e){if(!e.value)return null;if(this.props.value===Object(e.value)&&!Array.isArray(e.value))return null;var t=e.value,a=e.field,n=e.attribs,s=e.nodeData;Array.isArray(t)&&(t=t.join(", "));var r="";if(1==n.showLabel){var i=n.label;r=Object(g.jsx)("div",{className:"node-field-label "+a,children:i})}else r="";return n.truncate&&t.length>n.truncate&&(t=t.slice(0,n.truncate)+"..."),n.link&&(t=Object(g.jsx)("a",{href:s[n.link],children:t})),Object(g.jsxs)("div",{className:"node-field "+a,children:[r,Object(g.jsx)("div",{className:"node-field-value "+a,children:t})]})};var f=function(e){var t=[];if("HTML"==e.settings.apiNodeFormat)t=Object(g.jsx)("div",{dangerouslySetInnerHTML:{__html:e.nodeData}});else if(e.settings.directoryDisplaySchema)for(var a in e.settings.directoryDisplaySchema)e.settings.directoryDisplaySchema.hasOwnProperty(a)&&t.push(Object(g.jsx)(b,{field:a,value:e.nodeData[a],attribs:e.settings.directoryDisplaySchema[a],nodeData:e.nodeData}));return Object(g.jsx)("div",{className:"directory-node",children:t})};var v=function(e){console.log("Beginning of function");var t,a=Object(n.useState)(0),s=Object(u.a)(a,2),r=s[0],i=s[1],o=Object(n.useState)(null),c=Object(u.a)(o,2),l=c[0],d=c[1],h=parseInt(e.settings.nodesPerPage)||15,p=e.nodes;return Object(n.useEffect)((function(){var e=parseInt(r)*h,t=parseInt(e)+h;d(p.slice(e,t)),console.log("In other useEffect call"),console.log(r),console.log(e),console.log(t),console.log(h),console.log(p),console.log(l)}),[r,p]),e.loaded||(t=Object(g.jsx)("div",{class:"mri-directory-loading",children:Object(g.jsx)("img",{src:e.settings.clientPathToApp+"public/images/spinner.gif"})})),console.log("Before return"),console.log(r),console.log(h),console.log(p),console.log(l),Object(g.jsxs)("div",{children:[h,e.loaded?Object(g.jsxs)("div",{className:"nodeList",children:[Object(g.jsxs)("div",{className:"node-count",children:[p.length," results found"]}),l.map((function(t){return Object(g.jsx)(f,{nodeData:t,settings:e.settings})}))]}):t,Object(g.jsx)("div",{className:"react-paginate",children:Object(g.jsx)(m.a,{previousLabel:"prev",nextLabel:"next",breakLabel:"...",breakClassName:"break-me",pageCount:p.length/h,marginPagesDisplayed:2,pageRangeDisplayed:h,onPageChange:function(e){i(e.selected)},containerClassName:"pagination",subContainerClassName:"pages pagination",pageClassName:"page-link-li",activeClassName:"active"})})]})},O=a(502),x=a(505),y=a(503),S=a(504),k=a(15),D=a.n(k),N=function(e){var t=e.node;return Object(g.jsxs)("div",{children:[t.image&&Object(g.jsx)("img",{src:t.image[0].url,alt:"Node logo",maxWidth:"50%",height:8}),Object(g.jsx)("div",{children:t.url||t.urls?Object(g.jsx)("a",{href:t.url||t.urls[0].url,target:"_blank",rel:"noopener noreferrer",children:Object(g.jsx)("span",{wordBreak:"break-all",children:t.name})}):Object(g.jsx)("span",{wordBreak:"break-all",children:t.name})}),t.description&&Object(g.jsx)("div",{children:t.description.length>250?"".concat(t.description.slice(0,250),"..."):t.description})]})};a(499);delete D.a.Icon.Default.prototype._getIconUrl;var C=function(e){var t,a=e.nodes,n=e.settings,s=e.loaded;return D.a.Icon.Default.mergeOptions({iconRetinaUrl:n.clientPathToApp+"public/images/marker-icon-2x.png",iconUrl:n.clientPathToApp+"public/images/marker-icon.png",shadowUrl:n.clientPathToApp+"public/images/marker-shadow.png"}),s||(t=Object(g.jsx)("div",{class:"mri-map-loading",children:Object(g.jsx)("img",{src:n.clientPathToApp+"public/images/spinner.gif"})})),Object(g.jsxs)("div",{class:"mri-map-outer-container",children:[t,Object(g.jsxs)(O.a,{center:n.mapCenter,zoom:n.mapZoom,scrollWheelZoom:n.mapAllowScrollZoom,style:{height:"70vh",width:"100%",margin:"auto"},children:[Object(g.jsx)(x.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),a.map((function(e){if(e.data){var t=e.id;(e=e.data).id=t}return Object(g.jsx)("div",{children:e.geolocation?Object(g.jsx)(y.a,{position:[parseFloat(e.geolocation.lat),parseFloat(e.geolocation.lon)],children:Object(g.jsx)(S.a,{children:Object(g.jsx)(N,{node:e})})}):null},"".concat(e.id||e.objectID))}))]})]})},w=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).fetchNodes=n.fetchNodes.bind(Object(l.a)(n)),n.handleFilterSubmit=n.handleFilterSubmit.bind(Object(l.a)(n)),n.handleSearchSubmit=n.handleSearchSubmit.bind(Object(l.a)(n)),n.handleSearchChange=n.handleSearchChange.bind(Object(l.a)(n)),n.handleErrors=n.handleErrors.bind(Object(l.a)(n)),n.state={nodes:[],filterFormData:e.settings.formData},n}return Object(c.a)(a,[{key:"fetchNodes",value:function(e){var t=this,a=this.props.settings.apiUrl,n=this.props.settings.apiNodeFormat;this.setState({isLoaded:!1,nodes:[]});var s=new URLSearchParams(e);"directory"==this.props.interfaceComp&&s.set("format",n),this.state.search&&s.set("search",this.state.search),fetch(a+"?"+s.toString()).then((function(e){return e.json()})).then((function(e){t.setState({isLoaded:!0,nodes:e})}),(function(e){t.setState({isLoaded:!0,error:e})}))}},{key:"handleSearchChange",value:function(e){this.setState({search:e.target.value})}},{key:"handleSearchSubmit",value:function(e){e.preventDefault(),this.fetchNodes()}},{key:"handleErrors",value:function(){console.log("errors",this)}},{key:"handleFilterSubmit",value:function(e,t){var a=this,n=e.formData,s="";this.setState({filterFormData:n}),Object.keys(n).forEach((function(e,t){if(n[e]&&"any"!=n[e]&&""!=n[e]){if("operator"in a.props.settings.filterSchema.properties[e])var r=a.props.settings.filterSchema.properties[e].operator;else r="equals";s+="filters["+t+"][0]="+e+"&",s+="filters["+t+"][1]="+r+"&",s+="filters["+t+"][2]="+n[e]+"&"}})),this.fetchNodes(s)}},{key:"componentDidMount",value:function(){this.fetchNodes()}},{key:"render",value:function(){var e,t=this.props.settings.filterSchema,a=this.state,n=a.error,s=a.isLoaded,r=a.nodes;return n?e=Object(g.jsxs)("div",{children:["Error: ",n.message]}):"directory"==this.props.interfaceComp?e=Object(g.jsx)(v,{nodes:r,settings:this.props.settings,loaded:s}):"map"==this.props.interfaceComp&&(e=Object(g.jsx)(C,{nodes:r,settings:this.props.settings,loaded:s})),Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{className:"mri-filter-form",children:Object(g.jsx)(p.a,{schema:t,formData:this.state.filterFormData,onChange:this.handleFilterSubmit,onError:this.handleErrors})}),Object(g.jsx)("div",{className:"mri-search-form",children:Object(g.jsxs)("form",{action:"/",onSubmit:this.handleSearchSubmit,children:[Object(g.jsx)("input",{type:"text",name:"search",onChange:this.handleSearchChange,value:this.state.search}),Object(g.jsx)("button",{type:"submit",children:"Search"})]})}),e]})}}]),a}(s.a.Component),L=document.getElementById("murmurations-react-directory"),E=document.getElementById("murmurations-react-map");if(L){var F=window.wpReactSettings;i.a.render(Object(g.jsx)(w,{settings:F,interfaceComp:"directory"}),L)}if(E){var I=window.wpReactSettings;i.a.render(Object(g.jsx)(w,{settings:I,interfaceComp:"map"}),E)}}},[[500,1,2]]]);
//# sourceMappingURL=main.f446c041.chunk.js.map